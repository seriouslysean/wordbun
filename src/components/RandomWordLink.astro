---
import SiteButton from '~components/SiteButton.astro';
import { t } from '~utils/i18n-utils';

const { class: className, ...attrs } = Astro.props;
---

<SiteButton type="button" class={className} id="random-word-button" title={t('nav.random_word_title')} {...attrs}>
  {t('nav.random_word')}
</SiteButton>

<script>
import { getUrl, getWordUrl, getWordsUrl } from '~astro-utils/url-utils';

const wordListCache = { data: null as string[] | null };

async function getRandomWord() {
  try {
    if (!wordListCache.data) {
      const response = await fetch(getUrl('/words.json'));
      if (!response.ok) {
        throw new Error('Failed to fetch words');
      }
      wordListCache.data = await response.json();
    }

    if (!wordListCache.data || wordListCache.data.length === 0) {
      throw new Error('No words available');
    }

    const randomWord = wordListCache.data[Math.floor(Math.random() * wordListCache.data.length)];
    const wordUrl = getUrl(getWordUrl(randomWord));
    window.location.href = wordUrl;
  } catch {
    // Fallback to words page on any error
    window.location.href = getUrl(getWordsUrl());
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const button = document.getElementById('random-word-button');

  if (button) {
    button.addEventListener('click', getRandomWord);
  }
});
</script>


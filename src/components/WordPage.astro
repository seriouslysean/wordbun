---
import WordComponent from '#components/Word.astro';
import WordNav from '#components/WordNav.astro';
import WordContext from '#components/WordContext.astro';
import Layout from '#layouts/Layout.astro';
import type { WordData } from '#types';
import { STRUCTURED_DATA_TYPE } from '#astro-utils/schema-utils.ts';
import { getMetaDescription } from '#astro-utils/seo-utils.ts';
import { extractWordDefinition } from '#astro-utils/word-data-utils';
import { t } from '#utils/i18n-utils';

interface Props {
  wordData: WordData;
  previousWord?: WordData | null;
  nextWord?: WordData | null;
  structuredDataType?: string;
  contextData?: {
    wordLength: number;
    firstLetter: string;
    partOfSpeech?: string;
    lengthCount: number;
    letterCount: number;
    partOfSpeechCount?: number;
  };
}

const { wordData, previousWord, nextWord, structuredDataType = STRUCTURED_DATA_TYPE.WORD_SINGLE, contextData } = Astro.props;

if (!wordData) {
  return Astro.redirect('/404');
}

// Extract definition using shared utility
const { definition } = extractWordDefinition(wordData);
const pageDescription = getMetaDescription({
  word: wordData.word,
  definition,
});
---

<Layout
  title={wordData.word}
  word={wordData}
  description={pageDescription}
  structuredDataType={structuredDataType}
>

    <WordComponent word={wordData} />
    {contextData && (
      <WordContext
        wordLength={contextData.wordLength}
        firstLetter={contextData.firstLetter}
        partOfSpeech={contextData.partOfSpeech}
        lengthCount={contextData.lengthCount}
        letterCount={contextData.letterCount}
        partOfSpeechCount={contextData.partOfSpeechCount}
      />
    )}
    <WordNav
      previousWord={previousWord}
      nextWord={nextWord}
      previousLabel={t('nav.previous_word')}
      nextLabel={t('nav.next_word')}
    />

</Layout>

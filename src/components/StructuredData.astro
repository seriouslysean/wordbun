---
import type { CollectionPageSchema, DefinedTermSchema, WordSchemaData } from '~types';
import {
  STRUCTURED_DATA_TYPE,
  type StructuredDataType,
  getBreadcrumbSchema,
  getCollectionSchemaData,
  getWebsiteSchemaData,
  getWordSchemaData
} from '~astro-utils/schema-utils.ts';
import { seoConfig } from '~astro-utils/seo-utils.ts';
import { generateBreadcrumbs } from '~utils/breadcrumb-utils';

interface Props {
  word?: WordSchemaData;
  structuredDataType?: StructuredDataType;
  itemCount?: number;
}

const { word, structuredDataType, itemCount } = Astro.props;

const websiteSchema = getWebsiteSchemaData();

type SchemaType = DefinedTermSchema | CollectionPageSchema | ReturnType<typeof getBreadcrumbSchema>;
const schemas: SchemaType[] = [];

if (structuredDataType === STRUCTURED_DATA_TYPE.WORD_SINGLE && word) {
  const wordSchema = getWordSchemaData(word);
  if (wordSchema) {
    schemas.push(wordSchema);
  }
} else if (structuredDataType === STRUCTURED_DATA_TYPE.WORD_LIST) {
  const collectionSchema = getCollectionSchemaData(
    seoConfig.siteName,
    seoConfig.defaultDescription,
    itemCount ?? 0
  );
  schemas.push(collectionSchema);
}

const breadcrumbs = generateBreadcrumbs(Astro.url.pathname, import.meta.env.BASE_PATH);
const breadcrumbSchema = getBreadcrumbSchema(breadcrumbs);
if (breadcrumbSchema) {
  schemas.push(breadcrumbSchema);
}
---

<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} is:inline />

{schemas.map(schema => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} is:inline />
))}

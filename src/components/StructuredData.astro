---
import type { WordSchemaData } from '~types';
import { STRUCTURED_DATA_TYPE, type StructuredDataType, getBreadcrumbSchema, getWebsiteSchemaData, getWordSchemaData } from '~astro-utils/schema-utils.ts';
import { generateBreadcrumbs } from '~utils/breadcrumb-utils';

interface Props {
  word?: WordSchemaData;
  structuredDataType?: StructuredDataType;
}

const { word, structuredDataType } = Astro.props;

// Use utility function for website schema
const websiteSchema = getWebsiteSchemaData();

const schemas: any[] = [];

// Generate word schema if applicable
if (structuredDataType === STRUCTURED_DATA_TYPE.WORD_SINGLE && word) {
  const wordSchema = getWordSchemaData(word);
  if (wordSchema) {
    schemas.push(wordSchema);
  }
} else if (structuredDataType === STRUCTURED_DATA_TYPE.WORD_LIST) {
  // Collection schema for word list pages
  // Note: itemCount could be enhanced by passing actual count from page
  schemas.push({
    '@context': 'https://schema.org',
    '@type': 'CollectionPage',
    name: 'Word Collection',
    description: 'Educational vocabulary collection',
    mainEntity: {
      '@type': 'ItemList',
      numberOfItems: 0,
    },
    audience: {
      '@type': 'EducationalAudience',
      educationalRole: 'student',
    },
  });
}

// Add breadcrumb schema for non-home pages
const breadcrumbs = generateBreadcrumbs(Astro.url.pathname, import.meta.env.BASE_PATH);
const breadcrumbSchema = getBreadcrumbSchema(breadcrumbs);
if (breadcrumbSchema) {
  schemas.push(breadcrumbSchema);
}
---

<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} is:inline />

{schemas.map(schema => (
  <script type="application/ld+json" set:html={JSON.stringify(schema)} is:inline />
))}
